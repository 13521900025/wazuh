const char *schema_agents_sql = "/** SQL Schema for global database* Copyright 2016 Wazuh, Inc. <info@wazuh.com>* June 30, 2016.* This program is a free software, you can redistribute it* and/or modify it under the terms of GPLv2.*/CREATE TABLE IF NOT EXISTS fim_entry (file TEXT PRIMARY KEY,type TEXT NOT NULL CHECK (type IN ('file', 'registry')),date INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),changes INTEGER NOT NULL DEFAULT 1,size INTEGER,perm TEXT,uid TEXT,gid TEXT,md5 TEXT,sha1 TEXT,uname TEXT,gname TEXT,mtime INTEGER,inode INTEGER,sha256 TEXT);CREATE TABLE IF NOT EXISTS pm_event (id INTEGER PRIMARY KEY AUTOINCREMENT,date_first TEXT,date_last TEXT,log TEXT,pci_dss TEXT,cis TEXT);CREATE INDEX IF NOT EXISTS pm_event_log ON pm_event (log);CREATE INDEX IF NOT EXISTS pm_event_date ON pm_event (date_last);PRAGMA journal_mode=WAL;CREATE TABLE IF NOT EXISTS sys_netiface (scan_id INTEGER,scan_time TEXT,name TEXT,adapter TEXT,type TEXT,state TEXT,mtu INTEGER CHECK (mtu > 0),mac TEXT,tx_packets INTEGER,rx_packets INTEGER,tx_bytes INTEGER,rx_bytes INTEGER,tx_errors INTEGER,rx_errors INTEGER,tx_dropped INTEGER,rx_dropped INTEGER,PRIMARY KEY (scan_id, name));CREATE INDEX IF NOT EXISTS netiface_id ON sys_netiface (scan_id);CREATE TABLE IF NOT EXISTS sys_netproto (scan_id INTEGER REFERENCES sys_netiface (scan_id),iface TEXT REFERENCES sys_netiface (name),type TEXT,gateway TEXT,dhcp TEXT NOT NULL CHECK (dhcp IN ('enabled', 'disabled', 'unknown', 'BOOTP')) DEFAULT 'unknown',PRIMARY KEY (scan_id, iface, type));CREATE INDEX IF NOT EXISTS netproto_id ON sys_netproto (scan_id);CREATE TABLE IF NOT EXISTS sys_netaddr (scan_id INTEGER REFERENCES sys_netproto (scan_id),proto TEXT REFERENCES sys_netproto (type),address TEXT,netmask TEXT,broadcast TEXT,PRIMARY KEY (scan_id, proto, address));CREATE INDEX IF NOT EXISTS netaddr_id ON sys_netaddr (scan_id);CREATE TABLE IF NOT EXISTS sys_osinfo (scan_id INTEGER,scan_time TEXT,hostname TEXT,architecture TEXT,os_name TEXT,os_version TEXT,os_codename TEXT,os_major TEXT,os_minor TEXT,os_build TEXT,os_platform TEXT,sysname TEXT,release TEXT,version TEXT,PRIMARY KEY (scan_id, os_name));CREATE TABLE IF NOT EXISTS sys_hwinfo (scan_id INTEGER,scan_time TEXT,board_serial TEXT,cpu_name TEXT,cpu_cores INTEGER CHECK (cpu_cores > 0),cpu_mhz REAL CHECK (cpu_mhz > 0),ram_total INTEGER CHECK (ram_total > 0),ram_free INTEGER CHECK (ram_free > 0),ram_usage INTEGER CHECK (ram_usage >= 0 AND ram_usage <= 100),PRIMARY KEY (scan_id, board_serial));CREATE TABLE IF NOT EXISTS sys_ports (scan_id INTEGER,scan_time TEXT,protocol TEXT,local_ip TEXT,local_port INTEGER CHECK (local_port >= 0),remote_ip TEXT,remote_port INTEGER CHECK (remote_port >= 0),tx_queue INTEGER,rx_queue INTEGER,inode INTEGER,state TEXT,PID INTEGER,process TEXT);CREATE INDEX IF NOT EXISTS ports_id ON sys_ports (scan_id);CREATE TABLE IF NOT EXISTS sys_programs (scan_id INTEGER,scan_time TEXT,format TEXT NOT NULL CHECK (format IN ('deb', 'rpm', 'win', 'pkg')),name TEXT,priority TEXT,section TEXT,size INTEGER CHECK (size >= 0),vendor TEXT,install_time TEXT,version TEXT,architecture TEXT,multiarch TEXT,source TEXT,description TEXT,location TEXT,triaged INTEGER(1),PRIMARY KEY (scan_id, name, version, architecture));CREATE INDEX IF NOT EXISTS programs_id ON sys_programs (scan_id);CREATE TABLE IF NOT EXISTS sys_processes (scan_id INTEGER,scan_time TEXT,pid TEXT,name TEXT,state TEXT,ppid INTEGER,utime INTEGER,stime INTEGER,cmd TEXT,argvs TEXT,euser TEXT,ruser TEXT,suser TEXT,egroup TEXT,rgroup TEXT,sgroup TEXT,fgroup TEXT,priority INTEGER,nice INTEGER,size INTEGER,vm_size INTEGER,resident INTEGER,share INTEGER,start_time INTEGER,pgrp INTEGER,session INTEGER,nlwp INTEGER,tgid INTEGER,tty INTEGER,processor INTEGER,PRIMARY KEY (scan_id, pid));CREATE INDEX IF NOT EXISTS processes_id ON sys_processes (scan_id);CREATE TABLE IF NOT EXISTS ciscat_results (id INTEGER PRIMARY KEY AUTOINCREMENT,scan_id INTEGER,scan_time TEXT,benchmark TEXT,profile TEXT,pass INTEGER,fail INTEGER,error INTEGER,notchecked INTEGER,unknown INTEGER,score INTEGER);CREATE INDEX IF NOT EXISTS ciscat_id ON ciscat_results (scan_id);CREATE TABLE IF NOT EXISTS metadata (key TEXT PRIMARY KEY,value TEXT);CREATE TABLE IF NOT EXISTS scan_info (module TEXT PRIMARY KEY,first_start INTEGER,first_end INTEGER,start_scan INTEGER,end_scan INTEGER,fim_first_check INTEGER,fim_second_check INTEGER,fim_third_check INTEGER);";

const char *schema_global_sql = "/** SQL Schema for global database* Copyright 2016 Wazuh, Inc. <info@wazuh.com>* June 30, 2016.* This program is a free software, you can redistribute it* and/or modify it under the terms of GPLv2.*/CREATE TABLE IF NOT EXISTS agent (id INTEGER PRIMARY KEY,name TEXT NOT NULL,ip TEXT,internal_key TEXT,os_name TEXT,os_version TEXT,os_major TEXT,os_minor TEXT,os_codename TEXT,os_build TEXT,os_platform TEXT,os_uname TEXT,os_arch TEXT,version TEXT,config_sum TEXT,merged_sum TEXT,manager_host TEXT,node_name TEXT DEFAULT 'unknown',date_add TEXT NOT NULL,last_keepalive TEXT,status TEXT NOT NULL CHECK (status IN ('empty', 'pending', 'updated')) DEFAULT 'empty',fim_offset INTEGER NOT NULL DEFAULT 0,reg_offset INTEGER NOT NULL DEFAULT 0,`group` TEXT DEFAULT 'default');CREATE INDEX IF NOT EXISTS agent_name ON agent (name);CREATE INDEX IF NOT EXISTS agent_ip ON agent (ip);INSERT INTO agent (id, ip, name, date_add, last_keepalive, `group`) VALUES (0, '127.0.0.1', 'localhost', datetime(CURRENT_TIMESTAMP, 'localtime'), '9999-12-31 23:59:59', NULL);CREATE TABLE IF NOT EXISTS info (key TEXT PRIMARY KEY,value TEXT);CREATE TABLE IF NOT EXISTS `group`(id INTEGER PRIMARY KEY AUTOINCREMENT,name TEXT);CREATE TABLE IF NOT EXISTS belongs(id_agent INTEGER,id_group INTEGER,PRIMARY KEY (id_agent, id_group));PRAGMA journal_mode=WAL;";

const char *schema_vuln_detector_sql = "/** SQL Schema for vulnerability detector module* Copyright 2018 Wazuh, Inc. <info@wazuh.com>* January 28, 2018.* This program is a free software, you can redistribute it* and/or modify it under the terms of GPLv2.*/BEGIN;CREATE TABLE IF NOT EXISTS AGENTS (AGENT_ID INT NOT NULL,PACKAGE_NAME TEXT NOT NULL,VERSION TEXT NOT NULL,ARCH TEXT NOT NULL,PRIMARY KEY(AGENT_ID, PACKAGE_NAME, VERSION, ARCH));CREATE TABLE IF NOT EXISTS METADATA (OS TEXT PRIMARY KEY NOT NULL,PRODUCT_NAME TEXT NOT NULL,PRODUCT_VERSION TEXT,SCHEMA_VERSION TEXT NOT NULL,TIMESTAMP DATE NOT NULL);CREATE TABLE IF NOT EXISTS VULNERABILITIES_INFO (ID TEXT NOT NULL,TITLE TEXT,SEVERITY TEXT,PUBLISHED TEXT,UPDATED TEXT,REFERENCE TEXT,OS TEXT NOT NULL,RATIONALE TEXT,CVSS2 TEXT,CVSS3 TEXT,PATCH_INFO BOOLEAN,PRIMARY KEY(ID, OS));CREATE TABLE IF NOT EXISTS VULNERABILITIES (CVEID TEXT NOT NULL REFERENCES VULNERABILITIES_INFO(ID),OS TEXT NOT NULL REFERENCES VULNERABILITIES_INFO(V_OS),PACKAGE TEXT NOT NULL,PENDING BOOLEAN NOT NULL,OPERATION TEXT NOT NULL,OPERATION_VALUE TEXT,SECOND_OPERATION TEXT,SECOND_OPERATION_VALUE TEXT,PATCH TEXT,ARCH_OPERATION TEXT,ARCH_OPERATION_VALUE TEXT);CREATE INDEX IF NOT EXISTS IN_CVE ON VULNERABILITIES_INFO (ID);CREATE INDEX IF NOT EXISTS IN_PACK ON VULNERABILITIES (PACKAGE);CREATE INDEX IF NOT EXISTS IN_OP ON VULNERABILITIES (OPERATION);END;";
